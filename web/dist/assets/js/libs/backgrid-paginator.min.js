/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong
  Licensed under the MIT @license.
*/

(function(e,t,n,r){r.Extension.Paginator=r.Footer.extend({className:"paginator",windowSize:10,fastForwardHandleLabels:{first:"《",prev:"〈",next:"〉",last:"》"},template:t.template('<tr><td colspan="<%= colspan %>"><ul><% _.each(handles, function (handle) { %><li <% if (handle.className) { %>class="<%= handle.className %>"<% } %>><a href="#" <% if (handle.title) {%> title="<%= handle.title %>"<% } %>><%= handle.label %></a></li><% }); %></ul></td></tr>'),events:{"click a":"changePage"},initialize:function(e){r.Footer.prototype.initialize.call(this,e);var t=this.columns,n=this.collection.fullCollection;this.listenTo(t,"add",this.render),this.listenTo(t,"remove",this.render),this.listenTo(t,"change:renderable",this.render),this.listenTo(n,"add",this.render),this.listenTo(n,"remove",this.render),this.listenTo(n,"reset",this.render)},changePage:function(t){t.preventDefault();var n=e(t.target).text(),r=this.fastForwardHandleLabels,i=this.collection;if(r)switch(n){case r.first:return i.getFirstPage(),void 0;case r.prev:return i.hasPrevious()&&i.getPreviousPage(),void 0;case r.next:return i.hasNext()&&i.getNextPage(),void 0;case r.last:return i.getLastPage(),void 0}var s=i.state,o=1*e(t.target).text()-s.firstPage;i.getPage(0===s.firstPage?o:o+1)},makeHandles:function(){var e=[],t=this.collection,n=t.state,r=n.lastPage?n.lastPage:n.firstPage;r=0===n.firstPage?r:r-1;var i=0===n.firstPage?n.currentPage:n.currentPage-1,s=Math.floor(i/this.windowSize)*this.windowSize,o=s+this.windowSize;if(o=r>=o?o:r+1,"infinite"!==t.mode)for(var u=s;o>u;u++)e.push({label:u+1,title:"No. "+(u+1),className:i===u?"active":void 0});var a=this.fastForwardHandleLabels;return a&&(a.prev&&e.unshift({label:a.prev,className:t.hasPrevious()?void 0:"disabled"}),a.first&&e.unshift({label:a.first,className:t.hasPrevious()?void 0:"disabled"}),a.next&&e.push({label:a.next,className:t.hasNext()?void 0:"disabled"}),a.last&&e.push({label:a.last,className:t.hasNext()?void 0:"disabled"})),e},render:function(){this.$el.empty();var n=t.reduce(this.columns.pluck("renderable"),function(e,t){return t?e+1:e},0);return this.$el.append(e(this.template({colspan:n,handles:this.makeHandles()}))),this}})})(jQuery,_,Backbone,Backgrid);