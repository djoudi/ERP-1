/*!
 * jQuery Stepy - A Wizard Plugin
 *
 * Licensed under The MIT License
 *
 * @version        1.1.0
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/stepy
 *
 */

(function(e){var t={init:function(n){return this.each(function(){var r=e.extend({},e.fn.stepy.defaults,n),i=e(this).data("options",r),s=i.attr("id");if(s===undefined||s=="")s="stepy-"+e("."+i.attr("class")).index(this),i.attr("id",s);var o=e("<ul/>",{id:s+"-titles","class":"stepy-titles"});r.titleTarget?e(r.titleTarget).html(o):o.insertBefore(i),r.validate&&(jQuery.validator.setDefaults({ignore:r.ignore}),i.append('<div class="stepy-error"/>'));var u=i.children("fieldset"),f=undefined,l=undefined,h="",p="";u.each(function(n){f=e(this),f.addClass("step").attr("id",s+"-step-"+n).append('<p id="'+s+"-buttons-"+n+'" class="'+s+'-buttons"/>'),l=f.children("legend"),r.legend||l.hide(),h="",r.description&&(l.length?h="<span>"+l.html()+"</span>":e.error(s+": the legend element of the step "+(n+1)+" is required to set the description!")),p=f.attr("title"),p=p!=""?"<div>"+p+"</div>":"--",o.append('<li id="'+s+"-title-"+n+'">'+p+h+"</li>"),n==0?u.length>1&&t.createNextButton.call(i,n):(t.createBackButton.call(i,n),f.hide(),n<u.length-1&&t.createNextButton.call(i,n))});var d=o.children();d.first().addClass("current-step");var v=i.children(".finish");if(r.finishButton)if(v.length){var m=i.is("form"),g=undefined;r.finish&&m&&(g=i.attr("onsubmit"),i.attr("onsubmit","return false;")),v.click(function(e){if(r.finish&&!t.execute.call(i,r.finish,u.length-1))e.preventDefault();else if(m){g?i.attr("onsubmit",g):i.removeAttr("onsubmit");var n=v.attr("type")=="submit";!n&&(!r.validate||t.validate.call(i,u.length-1))&&i.submit()}}),v.appendTo(i.find("p:last"))}else e.error(s+': element with class name "finish" missing!');r.titleClick?d.click(function(){var n=d.filter(".current-step").attr("id").split("-"),s=parseInt(n[n.length-1],10),o=e(this).index();if(o>s){if(r.next&&!t.execute.call(i,r.next,o))return!1}else if(o<s&&r.back&&!t.execute.call(i,r.back,o))return!1;o!=s&&t.step.call(i,o+1)}):d.css("cursor","default"),u.delegate('input[type="text"], input[type="password"]',"keypress",function(t){var n=t.keyCode?t.keyCode:t.which;if(n==13){t.preventDefault();var r=e(this).parent().children("."+s+"-buttons");if(r.length){var i=r.children(".button-next");if(i.length)i.click();else{var o=r.children(".finish");o.length&&o.click()}}}}),u.first().find(":input:visible:enabled").first().select().focus()})},createBackButton:function(n){var r=this,i=this.attr("id"),s=this.data("options");e("<a/>",{id:i+"-back-"+n,href:"javascript:void(0);","class":"button-back",html:s.backLabel}).click(function(){(!s.back||t.execute.call(r,s.back,n-1))&&t.step.call(r,n-1+1)}).appendTo(e("#"+i+"-buttons-"+n))},createNextButton:function(n){var r=this,i=this.attr("id"),s=this.data("options");e("<a/>",{id:i+"-next-"+n,href:"javascript:void(0);","class":"button-next",html:s.nextLabel}).click(function(){(!s.next||t.execute.call(r,s.next,n+1))&&t.step.call(r,n+1+1)}).appendTo(e("#"+i+"-buttons-"+n))},execute:function(e,t){var n=e.call(this,t+1);return n||n===undefined},step:function(n){n--;var r=this.children("fieldset");n>r.length-1&&(n=r.length-1);var i=this.data("options");max=n;if(i.validate){var s=!0;for(var o=0;o<n;o++){s&=t.validate.call(this,o);if(i.block&&!s){max=o;break}}}r.hide().eq(max).show();var u=e("#"+this.attr("id")+"-titles").children();u.removeClass("current-step").eq(max).addClass("current-step");if(this.is("form")){var f=undefined;max==n?f=r.eq(max).find(":input:enabled:visible"):f=r.eq(max).find(".error").select().focus(),f.first().select().focus()}return i.select&&i.select.call(this,max+1),this},validate:function(t){if(!this.is("form"))return!0;var n=this.children("fieldset").eq(t),r=!0,i=e("#"+this.attr("id")+"-titles").children().eq(t),s=this.data("options"),o=this.validate();return e(n.find(":input:enabled").get().reverse()).each(function(){var t=o.element(e(this));t===undefined&&(t=!0),r&=t,r?s.errorImage&&i.removeClass("error-image"):(s.errorImage&&i.addClass("error-image"),o.focusInvalid())}),r}};e.fn.stepy=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not exist!")},e.fn.stepy.defaults={back:undefined,backLabel:"&lt; Back",block:!1,description:!0,errorImage:!1,finish:undefined,finishButton:!0,legend:!0,ignore:"",next:undefined,nextLabel:"Next &gt;",titleClick:!1,titleTarget:undefined,validate:!1,select:undefined}})(jQuery);