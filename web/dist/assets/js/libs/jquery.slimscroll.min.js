/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.0.5
 *
 */

(function(e){jQuery.fn.extend({slimScroll:function(t){var n=e.extend({wheelStep:20,width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:"0.2",railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,scroll:0,touchScrollStep:200},t);return this.each(function(){function r(e,t,r){var i=e,u=w.outerHeight()-S.outerHeight();t&&(i=parseInt(S.css("top"))+e*parseInt(n.wheelStep)/100*S.outerHeight(),i=Math.min(Math.max(i,0),u),S.css({top:i+"px"})),v=parseInt(S.css("top"))/(w.outerHeight()-S.outerHeight()),i=v*(w[0].scrollHeight-w.outerHeight()),r&&(i=e,e=i/w[0].scrollHeight*w.outerHeight(),e=Math.min(Math.max(e,0),u),S.css({top:e+"px"})),w.scrollTop(i),s(),o()}function i(){p=Math.max(w.outerHeight()/w[0].scrollHeight*w.outerHeight(),y),S.css({height:p+"px"})}function s(){i(),clearTimeout(c),v==~~v&&(b=n.allowPageScroll,g!=v&&w.trigger("slimscroll",0==~~v?"top":"bottom")),g=v,p>=w.outerHeight()?b=!0:(S.stop(!0,!0).fadeIn("fast"),n.railVisible&&x.stop(!0,!0).fadeIn("fast"))}function o(){n.alwaysVisible||(c=setTimeout(function(){(!n.disableFadeOut||!u)&&!f&&!l&&(S.fadeOut("slow"),x.fadeOut("slow"))},1e3))}var u,f,l,c,h,p,v,g,y=30,b=!1,w=e(this);if(w.parent().hasClass("slimScrollDiv")){var E=w.scrollTop(),S=w.parent().find(".slimScrollBar"),x=w.parent().find(".slimScrollRail");i(),t&&("scrollTo"in t?E=parseInt(n.scrollTo):"scrollBy"in t&&(E+=parseInt(n.scrollBy)),r(E,!1,!0))}else{n.height="auto"==n.height?w.parent().innerHeight():n.height,E=e("<div></div>").addClass(n.wrapperClass).css({position:"relative",overflow:"hidden",width:n.width,height:n.height}),w.css({overflow:"hidden",width:n.width,height:n.height});var x=e("<div></div>").addClass(n.railClass).css({width:n.size,height:"100%",position:"absolute",top:0,display:n.alwaysVisible&&n.railVisible?"block":"none","border-radius":n.size,background:n.railColor,opacity:n.railOpacity,zIndex:90}),S=e("<div></div>").addClass(n.barClass).css({background:n.color,width:n.size,position:"absolute",top:0,opacity:n.opacity,display:n.alwaysVisible?"block":"none","border-radius":n.size,BorderRadius:n.size,MozBorderRadius:n.size,WebkitBorderRadius:n.size,zIndex:99}),T="right"==n.position?{right:n.distance}:{left:n.distance};x.css(T),S.css(T),w.wrap(E),w.parent().append(S),w.parent().append(x),S.draggable({axis:"y",containment:"parent",start:function(){l=!0},stop:function(){l=!1,o()},drag:function(){r(0,e(this).position().top,!1)}}),x.hover(function(){s()},function(){o()}),S.hover(function(){f=!0},function(){f=!1}),w.hover(function(){u=!0,s(),o()},function(){u=!1,o()}),w.bind("touchstart",function(e){e.originalEvent.touches.length&&(h=e.originalEvent.touches[0].pageY)}),w.bind("touchmove",function(e){e.originalEvent.preventDefault(),e.originalEvent.touches.length&&r((h-e.originalEvent.touches[0].pageY)/n.touchScrollStep,!0)});var N=function(e){if(u){e=e||window.event;var t=0;e.wheelDelta&&(t=-e.wheelDelta/120),e.detail&&(t=e.detail/3),r(t,!0),e.preventDefault&&!b&&e.preventDefault(),b||(e.returnValue=!1)}};(function(){window.addEventListener?(this.addEventListener("DOMMouseScroll",N,!1),this.addEventListener("mousewheel",N,!1)):document.attachEvent("onmousewheel",N)})(),i(),"bottom"==n.start?(S.css({top:w.outerHeight()-S.outerHeight()}),r(0,!0)):"object"==typeof n.start&&(r(e(n.start).position().top,null,!0),n.alwaysVisible||S.hide())}}),this}}),jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})})(jQuery);