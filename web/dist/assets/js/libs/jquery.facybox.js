/*
 * facybox (for jQuery)
 * version: 1.0 (11/09/2009)
 * @requires jQuery v1.2 or later
 *
 * Examples at http://bitbonsai.com/facybox/
 *
 * Licensed under the MIT:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Copyright 2009 Mauricio Wolff [ chris@ozmm.org ]
 */

(function(e){function t(){if(e.facybox.settings.inited)return;e.facybox.settings.inited=!0,e(document).trigger("init.facybox"),r();var t=e.facybox.settings.imageTypes.join("|");e.facybox.settings.imageTypesRegexp=new RegExp(".("+t+")","i"),e("body").append(e.facybox.html());var i=e("#facybox");if(e.browser.msie){e(".n, .s, .w, .e, .nw, .ne, .sw, .se",i).fixPNG();if(parseInt(e.browser.version)<=6){var s="<style type='text/css' media='screen'>* html #facybox_overlay { position: absolute; height: expression(document.body.scrollHeight > document.body.offsetHeight ? document.body.scrollHeight : document.body.offsetHeight + 'px');}</style>";e("head").append(s),e(".close",i).fixPNG(),e(".close",i).css({right:"15px"})}e(".w, .e",i).css({width:"13px","font-size":"0"}).text("&nbsp;")}e.facybox.settings.noAutoload||n(),e("#facybox .close").click(e.facybox.close)}function n(){e("#facybox").find(".n, .close , .s, .w, .e, .nw, ne, sw, se").each(function(){backgroundImage=e(this).css("background-image");if(backgroundImage==="none")return;var t=new Image;t.src=backgroundImage.replace(/url\("?(.*?)"?\)/,"$1")})}function r(){var t=e.facybox.settings;t.imageTypes=t.image_types||t.imageTypes,t.facyboxHtml=t.facybox_html||t.facyboxHtml}function i(t){if(t.match(/#/)){var n=window.location.href.split("#")[0],r=t.replace(n,"");if(r=="#")return;e.facybox.reveal(e(r).html(),e.facybox.content_klass)}else t.match(e.facybox.settings.imageTypesRegexp)?o(t):u(t)}function s(t,n){function u(e){r=(r+e+t.length)%t.length,o(t[r]),s.find(".counter").html(r+1+" / "+t.length)}var r=e.inArray(n||0,t);r==-1&&(r=0);var i=e("#facybox div.footer");i.append(e('<div class="navigation"><a class="prev"/><a class="next"/><div class="counter"></div></div>'));var s=e("#facybox .navigation");e(document).bind("afterClose.facybox",function(){s.remove()}),u(0),e(".prev",s).click(function(){u(-1)}),e(".next",s).click(function(){u(1)}),e(document).bind("keydown.facybox",function(e){e.keyCode==39&&u(1),e.keyCode==37&&u(-1)})}function o(t){var n=e("#facybox");e("#facybox .content").empty(),e.facybox.loading();var r=new Image;r.onload=function(){e.facybox.reveal('<div class="image"><img src="'+r.src+'" /></div>',e.facybox.content_klass);var t=e("div.footer",n),i=e("div.content",n),s=e("div.navigation",n),o=e("a.next",n),u=e("a.prev",n),a=e("div.counter",n),f=[i.width(),i.height()];t.width(f[0]).height(f[1]),s.width(f[0]).height(f[1]),o.width(parseInt(f[0]/2)).height(f[1]).css({left:f[0]/2}),u.width(f[0]/2).height(f[1]),a.width(parseInt(n.width()-26)).css({opacity:.5,"-moz-border-radius":"8px","-webkit-border-radius":"8px"})},r.src=t}function u(t){e.ajax({type:"GET",url:t,complete:function(n,r){content_type=n.getResponseHeader("Content-Type"),jQuery.inArray(content_type,e.facybox.settings.imageMimeTypes)>=0?(o(t),e.facybox.centralize()):e.facybox.reveal(n.responseText)}})}function a(){return e.facybox.settings.overlay==0||e.facybox.settings.opacity===null}function f(){if(a())return;e("#facybox_overlay").length==0&&e("body").append('<div id="facybox_overlay" class="facybox_hide"></div>'),e("#facybox_overlay").hide().addClass("facybox_overlayBG").css("opacity",e.facybox.settings.opacity).fadeIn(200),e.facybox.settings.modal||e("#facybox_overlay").click(function(){e(document).trigger("close.facybox")})}function l(){if(a())return;e("#facybox_overlay").fadeOut(200,function(){e("#facybox_overlay").removeClass("facybox_overlayBG").addClass("facybox_hide").remove()})}e.fn.fixPNG=function(){return this.each(function(){var t=e(this).css("backgroundImage");t.match(/^url\(["']?(.*\.png)["']?\)$/i)&&(t=RegExp.$1,e(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod="+(e(this).css("backgroundRepeat")=="no-repeat"?"crop":"scale")+", src='"+t+"')"}).each(function(){var t=e(this).css("position");t!="absolute"&&t!="relative"&&e(this).css("position","relative")}))})},e.facybox=function(t,n){e.facybox.loading(),e.facybox.content_klass=n,t.ajax?u(t.ajax):t.image?o(t.image):t.images?s(t.images,t.initial):t.div?i(t.div):e.isFunction(t)?t.call(e):e.facybox.reveal(t)},e.extend(e.facybox,{settings:{opacity:.3,overlay:!0,modal:!1,imageTypes:["png","jpg","jpeg","gif"],imageMimeTypes:["image/jpeg","image/png","image/gif"]},html:function(){return'		<div id="facybox" style="display:none;"> 			<div class="popup"> 				<table> 					<tbody> 						<tr> 							<td class="nw"/><td class="n" /><td class="ne"/> 						</tr> 						<tr> 							<td class="w" /> 							<td class="body"> 							<div class="footer"> </div> 							<a href="#" class="close"></a>							<div class="content"> 							</div> 						</td> 							<td class="e"/> 						</tr> 						<tr> 							<td class="sw"/><td class="s"/><td class="se"/> 						</tr> 					</tbody> 				</table> 			</div> 		</div> 		<div class="loading"></div> 	'},loading:function(){t();if(e(".loading",e("#facybox"))[0])return;f(),e.facybox.wait(),e.facybox.settings.modal||e(document).bind("keydown.facybox",function(t){t.keyCode==27&&e.facybox.close()}),e(document).trigger("loading.facybox")},wait:function(){var t=e("#facybox");e(".content",t).empty(),e(".body",t).children().hide().end().append('<div class="loading"></div>'),t.fadeIn("fast"),e.facybox.centralize(),e(document).trigger("reveal.facybox").trigger("afterReveal.facybox")},centralize:function(){var t=e("#facybox"),n=e.facybox.getViewport(),r=parseInt(n[0]/2)-parseInt(t.find("table").width()/2),i=parseInt(t.height());if(n[1]>i){var s=n[3]+(n[1]-i)/2;t.css({left:r,top:s})}else{var s=n[3]+n[1]/10;t.css({left:r,top:s})}},getViewport:function(){return[e(window).width(),e(window).height(),e(window).scrollLeft(),e(window).scrollTop()]},reveal:function(t){e(document).trigger("beforeReveal.facybox");var n=e("#facybox");e(".content",n).attr("class",(e.facybox.content_klass||"")+" content").html(t),e(".loading",n).remove();var r=e(".body",n);r.children().fadeIn("fast"),e.facybox.centralize(),e(document).trigger("reveal.facybox").trigger("afterReveal.facybox")},close:function(){return e(document).trigger("close.facybox"),!1}}),e.fn.facybox=function(n){var r=e(this);return r[0]?(n&&e.extend(e.facybox.settings,n),e.facybox.settings.noAutoload||t(),r.bind("click.facybox",function(){e.facybox.loading();var t=this.rel.match(/facybox\[?\.(\w+)\]?/);return e.facybox.content_klass=t?t[1]:"",i(this.href),!1}),r):r},e(document).bind("close.facybox",function(){e(document).unbind("keydown.facybox");var t=e("#facybox");e.browser.msie?(e("#facybox").hide(),l(),e("#facybox .loading").remove()):e("#facybox").fadeOut("fast",function(){e("#facybox .content").removeClass().addClass("content"),l(),e("#facybox .loading").remove()}),e(document).trigger("afterClose.facybox")})})(jQuery);